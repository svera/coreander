<main>
    {{$lang := .Lang}}
    {{$emailSendingConfigured := .EmailSendingConfigured}}
    <div class="container">
        {{template "partials/searchbox" .}} {{if gt .Total 0}}
        <p>{{t .Lang "%d matches found" .Total }}</p>
        {{else}}
        <p>{{t .Lang "No matches found" }}</p>
        {{end}}

        <div class="list-group">
            {{if .Results}} {{range $i, $book := .Results}}
            <div class="list-group-item">
                <img src="covers/{{$book.ID}}" class="border border-2 border-dark float-start me-3 2-25">
                <div class="row">
                    <div class="col-7">
                        {{ if ne $book.Series "" }} {{$seriesTitle := t $lang "Search for more titles belonging to %s" $book.Series}}
                        <p class="text-start text-muted text-uppercase mb-0"><a
                                href="?search=Series&colon;&quot;{{$book.Series}}&quot;"
                                title={{$seriesTitle}}>{{$book.Series}} {{$book.SeriesIndex}}</a></p>
                        {{ end }}
                        <h4 class="text-start">{{$book.Title}} <small class="small text-muted">{{$book.Year}}</small>
                        </h4>
                    </div>
                    <div class="col-5 text-end">
                        {{ template "partials/actions" dict "Lang" $lang "BookID" $book.ID "EmailSendingConfigured" $emailSendingConfigured "Index" $i}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        {{$authorTitle := t $lang "Search for more titles by %s" $book.Author}}
                        <h5 class="text-start"><a href="?search=Author&colon;&quot;{{$book.Author}}&quot;"
                                title={{$authorTitle}}>{{$book.Author}}</a></h5>
                        {{ if ne $book.ReadingTime "" }}
                        <p class="text-start text-muted"><em>{{t $lang "Estimated reading time"}}:
                                {{$book.ReadingTime}}</em></p>
                        {{ end }}
                        <div class="mb-1 collapse" id="collapse-desc{{$i}}">{{$book.Description}}</div>
                        <a data-bs-toggle="collapse" class="collapse-control collapsed" href="#collapse-desc{{$i}}"></a>
                    </div>
                </div>
            </div>
            {{end}} {{end}}
        </div>

        {{ $length := len .Paginator.Pages }} {{ if gt $length 1 }}
        <nav aria-label="..." class="mt-5 mb-5">
            <ul class="pagination justify-content-center flex-wrap">
                {{$disabled := ""}} {{$ariaDisabled := ""}} {{ if not .Paginator.PreviousLink }} {{$disabled =
                "disabled"}} {{$ariaDisabled = "aria-disabled=\"true\""}} {{end}}
                <li class="page-item {{$disabled}}">
                    <a class="page-link" href="{{.Paginator.PreviousLink}}" tabindex="-1" {{$ariaDisabled}}>{{t $lang
                        "Previous"}}</a>
                </li>
                {{range $number, $page := .Paginator.Pages}} {{$active := ""}} {{ if $page.IsCurrent }} {{$active =
                "active"}} {{end}}
                <li class="page-item {{$active}}"><a class="page-link" href="{{$page.Link}}">{{$number}}</a></li>
                {{end}} {{$disabled := ""}} {{$ariaDisabled := ""}} {{ if not .Paginator.NextLink }} {{$disabled =
                "disabled"}} {{$ariaDisabled = "aria-disabled=\"true\""}} {{end}}
                <li class="page-item {{$disabled}}">
                    <a class="page-link" href="{{.Paginator.NextLink}}" tabindex="-1" {{$ariaDisabled}}>{{t $lang
                        "Next"}}</a>
                </li>
            </ul>
        </nav>
        {{end}}

    </div>

    <script type="text/javascript">
        function send(index)
        {
            event.preventDefault();
            form = document.getElementById("send-email-"+index)
            fetch('/send', {
                method: "POST",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email : form.elements[0].value,
                    file : form.elements[1].value,
                })
            })
            .then((response) => {
                message = document.getElementById("send-email-message-"+index)
                message.classList.remove("visually-hidden");
                if (!response.ok) {
                    message.innerHTML = '{{t .Lang "There was an error sending the document, please try again later"}}';
                    message.classList.add("text-danger");
                } else {
                    message.innerHTML = '{{t .Lang "Document sent succesfully"}}';
                    message.classList.add("text-success");
                }
            })
            .catch(function (error){
                // Catch errors
                console.log(error);
            });
        }
    </script>
</main>
