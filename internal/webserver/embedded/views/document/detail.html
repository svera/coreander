{{$lang := .Lang}}
<div class="row mt-5">
    <div class="col-12">
        {{if .BackLink}}
            <div class="mb-2">
                <a href="{{.BackLink}}" class="text-decoration-none">&larr; {{t $lang "Return"}}</a>
            </div>
            <hr />
        {{end}}
        {{ if ne .Document.Series "" }} {{$seriesTitle := t $lang "Search for more titles belonging to %s" .Document.Series}}
            <p class="text-start text-muted text-uppercase mb-1">{{.Document.Series}}{{ if ne .Document.SeriesIndex 0.0 }} {{.Document.SeriesIndex}}{{end}}</p>
        {{ end }}
        <header>
            <h1 class="text-start">
                {{.Document.Title}}
            </h1>

            {{if .Document.Authors}}
                <h2>
                    {{join .Document.Authors ", "}}
                </h2>
            {{else}}
                <h2>{{t .Lang "Unknown author"}}</h2>
            {{end}}
        </header>
    </div>
    <div class="col-12 col-md-4 mt-3 pe-3">
        <div class="mb-3">
            {{template "partials/cover" dict "Lang" .Lang "Document" .Document "Session" .Session "DisableCoverMainLink" true "Version" .Version}}
        </div>
        {{template "partials/actions" dict "Lang" .Lang "Document" .Document "Session" .Session "FQDN" .fqdn "Version" .Version "EmailSendingConfigured" .EmailSendingConfigured "DefaultAction" .DefaultAction "CanShare" .CanShare "PreferredEpub" .PreferredEpub "EmailFrom" .EmailFrom "ShareMaxRecipients" .ShareMaxRecipients "ShareCommentMaxSize" .ShareCommentMaxSize "ButtonSize" "btn-lg" "ButtonStyle" "btn-primary"}}

        <div id="document-metadata-{{.Document.Slug}}">
            {{template "partials/document-metadata" dict "Lang" .Lang "Document" .Document "Session" .Session "WordsPerMinute" .WordsPerMinute "IllustratedMinAmount" .IllustratedMinAmount}}
        </div>


        {{ if .Document.Subjects }}
        <ul class="list-inline">
            {{range $i, $subject := .Document.Subjects}}
            {{$subjectTitle := t $.Lang "Search for more titles in %s" $subject}}
            <li class="list-inline-item"><a class="btn btn-secondary btn-sm mb-1 mr-1" href="/documents?subjects={{urlquery $subject}}"
                title={{$subjectTitle}}>{{$subject}}</a></li>
            {{end}}
        </ul>
        {{ end }}
    </div>
    <div class="col-12 col-md-8 ps-3">
        <div class="row">
            <div class="col-12 text-start">
                {{if .Document.Description}}
                <div class="mb-1 mt-3 lead">{{.Document.Description}}</div>
                {{else}}
                <div class="mb-1"><p><i>{{t .Lang "No description available"}}</i></p></div>
                {{end}}
            </div>
        </div>


        {{if and (gt (len .Document.Authors) 0) (le (len .Document.Authors) 2) (ne (index .Document.Authors 0) "")}}
            <hr>
            {{range $i, $author := .Document.Authors}}
                <div class="row" hx-get="/authors/{{slugify $author}}/summary?style=clear" hx-trigger="load" hx-target="this">
                </div>
            {{end}}
        {{end}}

        {{ $length := len .SameSeries }} {{ if gt $length 0 }}
        <section class="row mt-5">
            <div class="col-9">
                <h3>{{t .Lang "Other titles in collection \"%s\"" .Document.Series}}</h3>
            </div>
            <div class="col-3 text-end">
                <a  href="/series/{{.Document.SeriesSlug}}">
                        {{t .Lang "See all" }}</a>
            </div>

            <div class="row pe-0 align-items-end">
                {{range $i, $doc := .SameSeries}}
                    <div class="col-6 col-lg-3 pe-0 mt-3">
                        {{template "partials/cover" dict "Lang" $.Lang "Document" $doc "Session" $.Session "Version" $.Version}}
                    </div>
                {{end}}
            </div>
        </section>
        {{end}}

        {{ $length := len .SameAuthors }} {{ if gt $length 0 }}
        <section class="row mt-5">
            <div class="col-9">
                <h3>
                    {{t .Lang "Also by"}}
                    {{join .Document.Authors ", "}}
                </h3>
            </div>
            <div class="col-3 text-end">
                {{if gt (len .Document.Authors) 1}}
                <a  href='/documents?search=AuthorsSlugs&colon;{{join .Document.AuthorsSlugs ","}}'>
                        {{t .Lang "See all" }}</a>
                {{else}}
                <a  href='/authors/{{index .Document.AuthorsSlugs 0}}'>
                    {{t .Lang "See all" }}</a>
                {{end}}
            </div>

            <div class="row pe-0 align-items-end">
                {{range $i, $doc := .SameAuthors}}
                <div class="col-6 col-lg-3 pe-0 mt-3">
                    {{template "partials/cover" dict "Lang" $.Lang "Document" $doc "Session" $.Session "Version" $.Version}}
                </div>
                {{end}}
            </div>
        </section>
        {{end}}

        {{ $length := len .SameSubjects }} {{ if gt $length 0 }}
        <section class="row mt-5">
            <div class="col-9">
                <h3>{{t .Lang "With similar subjects"}}</h3>
            </div>
            <div class="col-3 text-end">
                <a  href='/documents?subjects={{range $i, $s := .Document.Subjects}}{{if $i}},{{end}}{{urlquery $s}}{{end}}'>
                        {{t .Lang "See all" }}</a>
            </div>

            <div class="row pe-0 align-items-end">
                {{range $i, $doc := .SameSubjects}}
                <div class="col-6 col-lg-3 pe-0 mt-3">
                    {{template "partials/cover" dict "Lang" $.Lang "Document" $doc "Session" $.Session "Version" $.Version}}
                </div>
                {{end}}
            </div>
        </section>
        {{end}}
    </div>
</div>

<script type="module" src="/js/send-email.js{{versionParam .Version}}"></script>
<script type="module" src="/js/highlight.js{{versionParam .Version}}"></script>
<script type="module" src="/js/complete.js{{versionParam .Version}}"></script>
<script type="module" src="/js/cover.js{{versionParam .Version}}"></script>
<script type="module" src="/js/datetime.js{{versionParam .Version}}"></script>
