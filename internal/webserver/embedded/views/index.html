{{$lang := .Lang}}
{{$emailSendingConfigured := .EmailSendingConfigured}}
{{$session := .Session}}
{{$emailFrom := .EmailFrom}}
{{$reading := .Reading}}

<section class="pb-5 text-center">
    <img src="/images/coreander-header.png{{versionParam .Version}}" class="w-50 mt-5 color-invertible" alt="" />
    {{template "partials/searchbox" .}}
</section>

<section class="row py-5">
    {{if and (.Session) (ne .Session.Name "")}}
        {{if gt (len .Reading) 0}}
        {{if gt (len .LatestDocs) 0}}
        <div class="col-12 col-md-6 col-lg-3 mb-5" id="in-progress-docs">
            <div class="card px-0 bg-body-secondary">
                <div class="card-header text-center">
                    <h4 class="mb-0">{{ t .Lang "Resume reading" }}</h4>
                </div>
                <div class="card-body pb-0">
                    <div class="col-12">
                        <div id="resume-reading-docs" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                {{range $i, $doc := .Reading}}
                                <div class="carousel-item {{if eq $i 0}}active{{end}}">
                                {{template "partials/cover" dict "Lang" $lang "Document" $doc "Session" $session "DisableActions" true "LinkToReader" true "Version" $.Version}}
                                </div>
                                {{end}}
                            </div>
                            <div class="carousel-indicators position-relative pt-3">
                                {{range $i, $doc := .Reading}}
                                <button type="button" data-bs-target="#resume-reading-docs" data-bs-slide-to="{{$i}}" class="{{if eq $i 0}}active{{end}}" aria-current="{{if eq $i 0}}true{{end}}" aria-label="Slide {{$i}}"></button>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{else}}
        <div class="col-12 mb-5" id="in-progress-docs">
            <h2 class="border-bottom mb-3 pb-2">{{ t .Lang "Resume reading" }}</h2>
            <div id="resume-reading-docs" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    {{range $i, $doc := .Reading}}
                    <div class="carousel-item {{if eq $i 0}}active{{end}}" data-bs-interval="10000">
                        <div class="row">
                            <div class="d-none d-md-block col-md-8 d-lg-block col-lg-8">
                                {{ if ne $doc.Series "" }} {{$seriesTitle := t $lang "Search for more titles belonging to %s"
                                $doc.Series}}
                                    <p class="text-start text-muted text-uppercase mb-0">
                                        <a href="/series/{{$doc.SeriesSlug}}" title={{$seriesTitle}}>{{$doc.Series}}{{ if ne $doc.SeriesIndex 0.0 }} {{$doc.SeriesIndex}}{{end}}</a>
                                    </p>
                                {{end}}

                                <h4 class="text-start">
                                    <a href="/documents/{{$doc.Slug}}">{{$doc.Title}}</a>
                                </h4>

                                {{if $doc.Authors}}
                                <h5>
                                    {{range $i, $author := $doc.Authors}}
                                    {{$authorTitle := t $lang "Search for more titles by %s" $author}}
                                    <a href="/authors/{{index $doc.AuthorsSlugs $i}}" title={{$authorTitle}}>{{$author}}</a>{{if notLast $doc.Authors $i}}, {{end}}
                                    {{end}}
                                </h5>
                                {{else}}
                                    <h5>{{t $lang "Unknown author"}}</h5>
                                {{end}}
                                <div class="mt-5 d-none d-md-block d-lg-block">
                                    <div class="clamp">{{$doc.Description}}</div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 col-lg-4">
                                {{template "partials/cover" dict "Lang" $lang "Document" $doc "Session" $session "DisableActions" true "LinkToReader" true "Version" $.Version}}
                            </div>
                        </div>
                    </div>
                    {{end}}
                </div>
                <div class="carousel-indicators">
                    {{range $i, $doc := .Reading}}
                    <button type="button" data-bs-target="#resume-reading-docs" data-bs-slide-to="{{$i}}" class="{{if eq $i 0}}active{{end}}" aria-current="{{if eq $i 0}}true{{end}}" aria-label="Slide {{$i}}"></button>
                    {{end}}
                </div>
            </div>
        </div>
        {{end}}
        {{end}}
    {{end}}

    {{if gt (len .LatestDocs) 0}}
    <div class="col-12 {{if gt (len .Reading) 0}}col-md-6 col-lg-9{{end}}" id="latest-docs">
        <h2 class="border-bottom mb-3 pb-2">{{ t .Lang "Latest additions" }}</h2>
        <div id="latest-docs-carousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {{range $i, $doc := .LatestDocs}}
                <div class="carousel-item {{if eq $i 0}}active{{end}}" data-bs-interval="10000">
                    <div class="row">
                        <div class="d-none {{if eq (len $reading) 0}}d-md-block col-md-8{{end}} d-lg-block col-lg-8">
                            {{ if ne $doc.Series "" }} {{$seriesTitle := t $lang "Search for more titles belonging to %s"
                            $doc.Series}}
                                <p class="text-start text-muted text-uppercase mb-0">
                                    <a href="/series/{{$doc.SeriesSlug}}" title={{$seriesTitle}}>{{$doc.Series}}{{ if ne $doc.SeriesIndex 0.0 }} {{$doc.SeriesIndex}}{{end}}</a>
                                </p>
                            {{end}}

                            <h4 class="text-start">
                                <a href="/documents/{{$doc.Slug}}">{{$doc.Title}}</a>
                            </h4>

                            {{if $doc.Authors}}
                            <h5>
                                {{range $i, $author := $doc.Authors}}
                                {{$authorTitle := t $lang "Search for more titles by %s" $author}}
                                <a href="/authors/{{index $doc.AuthorsSlugs $i}}" title={{$authorTitle}}>{{$author}}</a>{{if notLast $doc.Authors $i}}, {{end}}
                                {{end}}
                            </h5>
                            {{else}}
                                <h5>{{t $lang "Unknown author"}}</h5>
                            {{end}}
                            </dl>
                            <div class="mt-5 d-none {{if eq (len $reading) 0}}d-md-block{{end}} d-lg-block">
                                <div class="clamp">{{$doc.Description}}</div>
                            </div>
                        </div>
                        <div class="col-12 {{if eq (len $reading) 0}}col-md-4{{end}} col-lg-4">
                            {{template "partials/cover" dict "Lang" $lang "Document" $doc "Session" $session "Version" $.Version}}
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
            <div class="carousel-indicators">
                {{range $i, $doc := .LatestDocs}}
                <button type="button" data-bs-target="#latest-docs-carousel" data-bs-slide-to="{{$i}}" class="{{if eq $i 0}}active{{end}}" aria-current="{{if eq $i 0}}true{{end}}" aria-label="Slide {{$i}}"></button>
                {{end}}
            </div>
        </div>
    </div>
</section>
{{end}}

{{if and (.Session) (ne .Session.Name "")}}
<div class="row border-bottom">
    <div class="col-6">
        <h3>{{t .Lang "Your highlights" }}</h3>
    </div>
    <div class="col-6">
        <p class="text-end">
            <a href="/highlights">{{t .Lang "See all"}}</a>
        </p>
    </div>
</div>
<div class="row">
    <div class="row pe-0" id="latest-highlights" hx-get="/highlights?view=latest" hx-trigger="load, highlight from:body, dehighlight from:body">
    </div>
</div>
{{end}}

<script type="module" src="/js/highlight.js{{versionParam .Version}}"></script>
<script type="module" src="/js/complete.js{{versionParam .Version}}"></script>
<script type="module" src="/js/cover.js{{versionParam .Version}}"></script>
<script type="module" src="/js/send-email.js{{versionParam .Version}}"></script>
