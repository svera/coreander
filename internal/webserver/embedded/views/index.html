{{$lang := .Lang}}
{{$emailSendingConfigured := .EmailSendingConfigured}}
{{$session := .Session}}
{{$emailFrom := .EmailFrom}}
{{$reading := .Reading}}

<section class="pb-5 text-center">
    <img src="/images/coreander-header.png{{versionParam .Version}}" class="w-50 mt-5 color-invertible" alt="" />
    {{template "partials/searchbox" .}}
</section>

<section class="row py-5">
    {{if and (.Session) (ne .Session.Name "")}}
        {{if gt (len .Reading) 0}}
        {{if gt (len .LatestDocs) 0}}
        <div class="col-12 col-md-6 col-lg-3 mb-5" id="in-progress-docs">
            <div class="card px-0 bg-body-secondary">
                <div class="card-header text-center">
                    <h4 class="mb-0">{{ t .Lang "Resume reading" }}</h4>
                </div>
                <div class="card-body pb-0">
                    <div class="col-12">
                        <div id="resume-reading-docs" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                {{range $i, $doc := .Reading}}
                                <div class="carousel-item {{if eq $i 0}}active{{end}}">
                                {{template "partials/cover" dict "Lang" $lang "Document" $doc "Session" $session "DisableActions" true "LinkToReader" true "Version" $.Version}}
                                </div>
                                {{end}}
                            </div>
                            <div class="carousel-indicators position-relative pt-3">
                                {{range $i, $doc := .Reading}}
                                <button type="button" data-bs-target="#resume-reading-docs" data-bs-slide-to="{{$i}}" class="{{if eq $i 0}}active{{end}}" aria-current="{{if eq $i 0}}true{{end}}" aria-label="Slide {{$i}}"></button>
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{else}}
        <div class="col-12 mb-5" id="in-progress-docs">
            <h2 class="border-bottom mb-3 pb-2">{{ t .Lang "Resume reading" }}</h2>
            <div id="resume-reading-docs" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    {{range $i, $doc := .Reading}}
                    {{template "partials/carousel-document-item" dict "Index" $i "Document" $doc "Lang" $lang "Session" $session "LinkToReader" true "Version" $.Version "ShowClasses" true}}
                    {{end}}
                </div>
                <div class="carousel-indicators">
                    {{range $i, $doc := .Reading}}
                    <button type="button" data-bs-target="#resume-reading-docs" data-bs-slide-to="{{$i}}" class="{{if eq $i 0}}active{{end}}" aria-current="{{if eq $i 0}}true{{end}}" aria-label="Slide {{$i}}"></button>
                    {{end}}
                </div>
            </div>
        </div>
        {{end}}
        {{end}}
    {{end}}

    {{if gt (len .LatestDocs) 0}}
    <div class="col-12 {{if gt (len .Reading) 0}}col-md-6 col-lg-9{{end}}" id="latest-docs">
        <h2 class="border-bottom mb-3 pb-2">{{ t .Lang "Latest additions" }}</h2>
        <div id="latest-docs-carousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {{range $i, $doc := .LatestDocs}}
                {{template "partials/carousel-document-item" dict "Index" $i "Document" $doc "Lang" $lang "Session" $session "LinkToReader" false "Version" $.Version "ShowClasses" (eq (len $reading) 0)}}
                {{end}}
            </div>
            <div class="carousel-indicators">
                {{range $i, $doc := .LatestDocs}}
                <button type="button" data-bs-target="#latest-docs-carousel" data-bs-slide-to="{{$i}}" class="{{if eq $i 0}}active{{end}}" aria-current="{{if eq $i 0}}true{{end}}" aria-label="Slide {{$i}}"></button>
                {{end}}
            </div>
        </div>
    </div>
</section>
{{end}}

{{if and (.Session) (ne .Session.Name "")}}
<div class="row border-bottom">
    <div class="col-6">
        <h3>{{t .Lang "Your highlights" }}</h3>
    </div>
    <div class="col-6">
        <p class="text-end">
            <a href="/highlights">{{t .Lang "See all"}}</a>
        </p>
    </div>
</div>
<div class="row">
    <div class="row pe-0" id="latest-highlights" hx-get="/highlights?view=latest" hx-trigger="load, highlight from:body, dehighlight from:body">
    </div>
</div>
{{end}}

<script type="module" src="/js/highlight.js{{versionParam .Version}}"></script>
<script type="module" src="/js/complete.js{{versionParam .Version}}"></script>
<script type="module" src="/js/cover.js{{versionParam .Version}}"></script>
<script type="module" src="/js/send-email.js{{versionParam .Version}}"></script>
